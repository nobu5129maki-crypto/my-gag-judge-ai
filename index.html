<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIãŠç¬‘ã„å¯©æŸ»å“¡</title>
    
    <!-- PWAè¨­å®šï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ãŸéš›ã«ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«å‹•ãã¾ã™ï¼‰ -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="AIå¯©æŸ»å“¡">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2250%%22 y=%2250%%22 style=%22dominant-baseline:central;text-anchor:middle;font-size:80px;%22>ğŸ™ï¸</text></svg>">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+JP:wght@400;700;900&display=swap');
        
        body { font-family: 'Noto Sans JP', sans-serif; }
        .rank-font { font-family: 'DotGothic16', sans-serif; }

        @keyframes pop-in {
            0% { transform: scale(0.9); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        .bg-gradient-custom {
            background: linear-gradient(135deg, #fff5ed 0%, #ffe4d1 100%);
        }

        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="bg-gradient-custom min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [gagInput, setGagInput] = useState('');
            const [isJudging, setIsJudging] = useState(false);
            const [judgement, setJudgement] = useState(null);
            const [error, setError] = useState(null);

            // ã€é‡è¦ã€‘ã“ã“ã«ã‚ãªãŸã®APIã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ãŸçŠ¶æ…‹ã§ä¿å­˜ã—ã¦ãã ã•ã„
            // APIã‚­ãƒ¼ãŒç©ºã€ã¾ãŸã¯ç„¡åŠ¹ãªå ´åˆã«å‚™ãˆã¦ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™
            const API_KEY = AIzaSyDq9jo6c9wY1d625Lj23R24_7Vjr7pr0Gw;

            const judgeGag = async () => {
                if (!gagInput.trim() || isJudging) return;
                
                setIsJudging(true);
                setError(null);
                setJudgement(null);

                // APIã‚­ãƒ¼ã®ç°¡æ˜“ãƒã‚§ãƒƒã‚¯
                if (!API_KEY || API_KEY.includes("ã“ã“ã«")) {
                    setError("APIã‚­ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰å†…ã®API_KEYã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚");
                    setIsJudging(false);
                    return;
                }

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{ 
                                parts: [{ text: `å¯©æŸ»å¯¾è±¡ã®ãƒã‚¿: ${gagInput}` }] 
                            }],
                            systemInstruction: { 
                                parts: [{ text: "ã‚ãªãŸã¯ãƒ—ãƒ­ã®ãŠç¬‘ã„å¯©æŸ»å“¡ã§ã™ã€‚M-1ã‚°ãƒ©ãƒ³ãƒ—ãƒªã®å¯©æŸ»å“¡ã®ã‚ˆã†ãªé¢¨æ ¼ã§ã€ä»¥ä¸‹ã®JSONå½¢å¼ã§å³æ ¼ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚è¿”ä¿¡ã¯JSONã®ã¿ã«ã—ã¦ãã ã•ã„ï¼š{ \"rank\": \"S/A/B/C/D\", \"score\": 0-100, \"critique\": \"100æ–‡å­—ç¨‹åº¦ã®ãƒ—ãƒ­è¦–ç‚¹ã®å¯¸è©•\", \"catchphrase\": \"èŠ¸äººã®äºŒã¤å\" }" }] 
                            },
                            generationConfig: { 
                                responseMimeType: "application/json",
                                temperature: 0.9
                            }
                        })
                    });
                    
                    const data = await response.json();

                    if (!response.ok) {
                        // ã‚¨ãƒ©ãƒ¼è©³ç´°ã®å–å¾—
                        if (response.status === 429) {
                            throw new Error("ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚1åˆ†ã»ã©å¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
                        } else if (response.status === 400) {
                            throw new Error("APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¸æ­£ã§ã™ã€‚APIã‚­ãƒ¼ãŒæœ‰åŠ¹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                        } else {
                            throw new Error(data.error?.message || "ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                        }
                    }

                    if (!data.candidates || data.candidates.length === 0) {
                        throw new Error("AIãŒå›ç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ä¸é©åˆ‡ãªè¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
                    }

                    const resultText = data.candidates[0].content.parts[0].text;
                    const result = JSON.parse(resultText);
                    setJudgement(result);
                } catch (err) {
                    console.error("Judge Error:", err);
                    setError(err.message || "äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                } finally {
                    setIsJudging(false);
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col shadow-2xl bg-white relative">
                    {/* Header */}
                    <header className="bg-orange-600 text-white p-6 pt-10 rounded-b-[3rem] shadow-lg text-center">
                        <div className="text-4xl mb-2">ğŸ™ï¸</div>
                        <h1 className="text-2xl font-black tracking-tighter">AIãŠç¬‘ã„å¯©æŸ»å“¡</h1>
                        <p className="text-orange-100 text-xs mt-1 opacity-80 italic">Professional Comedy Judge AI</p>
                    </header>
                    
                    <main className="flex-grow px-6 py-8 space-y-8">
                        {/* Input Area */}
                        <div className="space-y-4">
                            <div className="flex items-center gap-2 text-orange-600 font-bold ml-1">
                                <span className="animate-bounce">âœ¨</span>
                                <span>ãƒã‚¿ã‚’æŠ«éœ²ã—ã¦ãã ã•ã„</span>
                            </div>
                            <div className="relative group">
                                <textarea
                                    className="w-full h-40 p-5 border-2 border-orange-100 rounded-3xl bg-orange-50/30 text-lg outline-none focus:border-orange-500 focus:bg-white transition-all resize-none shadow-inner"
                                    placeholder="ã“ã“ã«ãƒœã‚±ã‚„ãƒã‚¿ã‚’å…¥åŠ›..."
                                    value={gagInput}
                                    onChange={(e) => setGagInput(e.target.value)}
                                />
                                <div className="absolute bottom-4 right-4 text-xs text-orange-300 font-bold">
                                    {gagInput.length} æ–‡å­—
                                </div>
                            </div>
                            <button
                                onClick={judgeGag}
                                disabled={isJudging || !gagInput.trim()}
                                className="w-full bg-orange-600 text-white font-black py-5 rounded-2xl shadow-[0_6px_0_rgb(194,65,12)] hover:translate-y-[2px] hover:shadow-[0_4px_0_rgb(194,65,12)] active:translate-y-[6px] active:shadow-none disabled:bg-gray-300 disabled:shadow-none transition-all text-xl flex items-center justify-center gap-3"
                            >
                                {isJudging ? (
                                    <>
                                        <div className="w-5 h-5 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
                                        <span>å¯©æŸ»ä¸­...</span>
                                    </>
                                ) : (
                                    "AIã«å¯©æŸ»ã—ã¦ã‚‚ã‚‰ã†"
                                )}
                            </button>
                        </div>

                        {/* Error Message */}
                        {error && (
                            <div className="text-red-600 text-sm text-center bg-red-50 p-4 rounded-2xl border border-red-200 font-bold animate-shake">
                                âš ï¸ {error}
                            </div>
                        )}

                        {/* Result Area */}
                        {judgement && (
                            <div className="animate-pop space-y-4 pt-4">
                                <div className="bg-white rounded-[2.5rem] shadow-2xl border-4 border-orange-500 overflow-hidden relative">
                                    {/* Catchphrase */}
                                    <div className="bg-orange-500 py-2 px-4 text-white font-bold text-center text-sm tracking-widest uppercase">
                                        {judgement.catchphrase}
                                    </div>

                                    <div className="p-8 text-center space-y-6">
                                        {/* Rank Badge */}
                                        <div className="relative inline-block group">
                                            <div className="absolute inset-0 bg-orange-200 rounded-full blur-xl opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                            <div className="relative text-8xl font-black text-orange-600 rank-font drop-shadow-xl transform -rotate-3">
                                                {judgement.rank}
                                            </div>
                                        </div>

                                        {/* Score */}
                                        <div className="text-5xl font-black text-slate-800 tracking-tighter">
                                            {judgement.score}<span className="text-xl ml-1 font-bold">ç‚¹</span>
                                        </div>

                                        {/* Critique */}
                                        <div className="relative">
                                            <div className="text-4xl text-orange-200 absolute -top-4 -left-2 opacity-50">â€œ</div>
                                            <div className="bg-orange-50/50 p-6 rounded-2xl text-left border-l-8 border-orange-400">
                                                <p className="text-slate-700 leading-relaxed font-bold text-sm">
                                                    {judgement.critique}
                                                </p>
                                            </div>
                                            <div className="text-4xl text-orange-200 absolute -bottom-8 -right-2 opacity-50">â€</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button 
                                    onClick={() => { setGagInput(''); setJudgement(null); }}
                                    className="w-full py-3 text-orange-500 font-bold text-sm hover:underline"
                                >
                                    ã‚‚ã†ä¸€åº¦ãƒã‚¿ã‚’æŠ«éœ²ã™ã‚‹
                                </button>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="p-8 text-center border-t border-orange-50 bg-orange-50/20">
                        <p className="text-gray-400 text-[10px] tracking-widest font-bold uppercase">
                            Â© AI OWARAI JUDGE PROJECT
                        </p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>