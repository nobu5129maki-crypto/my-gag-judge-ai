<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIãŠç¬‘ã„å¯©æŸ»å“¡</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2250%%22 y=%2250%%22 style=%22dominant-baseline:central;text-anchor:middle;font-size:80px;%22>ğŸ™ï¸</text></svg>">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+JP:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background: linear-gradient(135deg, #fff5ed 0%, #ffe4d1 100%); }
        .rank-font { font-family: 'DotGothic16', sans-serif; }
        @keyframes pop-in { 0% { transform: scale(0.9); opacity: 0; } 70% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const App = () => {
            const [gagInput, setGagInput] = useState('');
            const [isJudging, setIsJudging] = useState(false);
            const [judgement, setJudgement] = useState(null);
            const [error, setError] = useState(null);

            // ç›´æ¥ã‚­ãƒ¼ã‚’åŸ‹ã‚è¾¼ã‚€ç®‡æ‰€
            const API_KEY = "AIzaSyDbypjN7XwG6c5Ny1VvGHpR8m_feOLDmXs"; 

            const judgeGag = async () => {
                if (!gagInput.trim() || isJudging) return;
                setIsJudging(true);
                setError(null);

                try {
                    if (!API_KEY || API_KEY === "" || API_KEY.includes("ã“ã“ã«")) {
                        throw new Error("APIã‚­ãƒ¼ãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
                    }

                    // ãƒ¢ãƒ‡ãƒ«åã‚’ã‚ˆã‚Šå…·ä½“çš„ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ä»˜ãã«å¤‰æ›´
                    // gemini-1.5-flash ã§ã¯ãªãã€ç¢ºå®Ÿã«å­˜åœ¨ã™ã‚‹ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
                    const modelName = "gemini-1.5-flash-002"; 
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${API_KEY}`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ 
                                parts: [{ text: `ã‚ãªãŸã¯ãƒ—ãƒ­ã®ãŠç¬‘ã„å¯©æŸ»å“¡ã§ã™ã€‚ä»¥ä¸‹ã®ãƒã‚¿ã‚’è©•ä¾¡ã—ã€æŒ‡å®šã®JSONå½¢å¼ã®ã¿ã§è¿”ç­”ã—ã¦ãã ã•ã„ã€‚ãã‚Œä»¥å¤–ã®æ–‡å­—ï¼ˆ\`\`\`jsonãªã©ï¼‰ã¯ä¸€åˆ‡å«ã‚ãªã„ã§ãã ã•ã„ã€‚ï¼š${gagInput}` }] 
                            }],
                            generationConfig: { 
                                responseMimeType: "application/json",
                                responseSchema: {
                                    type: "OBJECT",
                                    properties: {
                                        rank: { type: "STRING", enum: ["S", "A", "B", "C", "D"] },
                                        score: { type: "NUMBER" },
                                        critique: { type: "STRING" },
                                        catchphrase: { type: "STRING" }
                                    },
                                    required: ["rank", "score", "critique", "catchphrase"]
                                },
                                temperature: 0.7
                            }
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        const errMsg = data.error?.message || "é€šä¿¡ã‚¨ãƒ©ãƒ¼";
                        const errReason = data.error?.status || "Unknown";
                        // NOT_FOUNDãŒå‡ºã‚‹å ´åˆã¯ãƒ¢ãƒ‡ãƒ«åã®ä¸ä¸€è‡´
                        throw new Error(`${errMsg} (${errReason})`);
                    }

                    const resultText = data.candidates[0].content.parts[0].text;
                    setJudgement(JSON.parse(resultText));
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsJudging(false);
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col bg-white shadow-xl">
                    <header className="bg-orange-600 text-white p-8 pt-12 rounded-b-[3rem] text-center shadow-lg">
                        <div className="text-5xl mb-2">ğŸ™ï¸</div>
                        <h1 className="text-2xl font-black italic tracking-tighter">AIãŠç¬‘ã„å¯©æŸ»å“¡</h1>
                        <p className="text-xs opacity-80 mt-1 uppercase tracking-widest">Version 1.5.2 Patch</p>
                    </header>
                    <main className="p-6 space-y-6">
                        <textarea
                            className="w-full h-40 p-4 border-2 border-orange-100 rounded-3xl bg-orange-50/30 outline-none focus:border-orange-500 transition-all text-slate-800 text-lg"
                            placeholder="ãƒã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
                            value={gagInput}
                            onChange={(e) => setGagInput(e.target.value)}
                        />
                        <button
                            onClick={judgeGag}
                            disabled={isJudging || !gagInput.trim()}
                            className="w-full bg-orange-600 text-white font-bold py-5 rounded-2xl shadow-lg active:scale-95 disabled:bg-slate-300 transition-all text-xl"
                        >
                            {isJudging ? "å¯©æŸ»ä¸­..." : "å¯©æŸ»ã‚’é–‹å§‹ã™ã‚‹"}
                        </button>
                        
                        {error && (
                            <div className="bg-red-50 border-2 border-red-200 text-red-600 p-4 rounded-2xl text-xs font-bold leading-relaxed">
                                âš ï¸ ã‚¨ãƒ©ãƒ¼ï¼š<br/>{error}<br/><br/>
                                <span className="opacity-70 font-normal underline">
                                    ã‚‚ã—NOT_FOUNDãŒæ¶ˆãˆãªã„å ´åˆã¯ã€Google AI Studioã®å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ŒModel settingsã€ã‹ã‚‰ã€ä½¿ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã®ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                                </span>
                            </div>
                        )}

                        {judgement && (
                            <div className="animate-pop p-6 border-4 border-orange-500 rounded-[2rem] text-center space-y-4 bg-white shadow-xl relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-1 bg-orange-500"></div>
                                <div className="text-xs font-bold text-orange-500 tracking-widest uppercase">{judgement.catchphrase}</div>
                                <div className="text-8xl font-black text-orange-600 rank-font leading-none">{judgement.rank}</div>
                                <div className="text-3xl font-black text-slate-800">{judgement.score}<span className="text-sm ml-1">ç‚¹</span></div>
                                <div className="text-sm text-left bg-orange-50 p-4 rounded-xl italic font-bold text-slate-700 leading-relaxed border border-orange-100">
                                    ã€Œ{judgement.critique}ã€
                                </div>
                            </div>
                        )}
                    </main>
                    <footer className="mt-auto p-6 text-center text-slate-400 text-[10px] tracking-widest uppercase">
                        Â© 2024 AI Comedy Judge - Patch Applied
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>